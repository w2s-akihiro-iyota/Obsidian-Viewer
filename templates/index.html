{% extends "base.html" %}

{% block title %}Files - Obsidian Viewer{% endblock %}


{% block sidebar_class %}{% endblock %}

{% block content %}
<div class="index-header">
    <div class="index-header-top">
        <h1>Notes</h1>
        <div class="view-toggle">
            <button id="list-view-btn" class="view-toggle-btn active" title="List View">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
            </button>
            <button id="grid-view-btn" class="view-toggle-btn" title="Grid View">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
            </button>
        </div>
    </div>

    <details class="search-accordion" {% if selected_tag %}open{% endif %}>
        <summary class="search-summary">
            <form action="/" method="get" class="search-form">
                <div class="search-input-wrapper">
                    <input type="text" name="q" value="{{ q }}" placeholder="Search notes..." class="search-input">
                    {% if selected_tag %}<input type="hidden" name="tag" value="{{ selected_tag }}">{% endif %}
                    <button type="submit" class="search-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8" />
                            <path d="m21 21-4.3-4.3" />
                        </svg>
                    </button>
                </div>
                <span class="accordion-hint">Filter by tags <span class="accordion-icon">笆ｼ</span></span>
            </form>
        </summary>
        <div class="tag-filter-container" style="padding: 10px 15px 0;">
            <input type="text" id="tag-filter-input" placeholder="Filter tags..."
                style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-normal);">
        </div>
        <script>
            document.getElementById('tag-filter-input').addEventListener('input', function (e) {
                const term = e.target.value.toLowerCase();
                const tags = document.querySelectorAll('.tag-chip');
                tags.forEach(tag => {
                    const text = tag.textContent.trim().replace('#', '').toLowerCase();
                    if (text.includes(term) || tag.textContent.trim() === 'All') {
                        tag.style.display = 'inline-block';
                    } else {
                        tag.style.display = 'none';
                    }
                });
            });
        </script>
        <div class="tag-cloud">
            <a href="/?q={{ q }}" class="tag-chip {% if not selected_tag %}active{% endif %}">
                All
            </a>
            {% for t in all_tags %}
            <a href="/?q={{ q }}&tag={{ t }}"
                class="tag-chip {% if selected_tag|string|trim == t|string|trim %}active{% endif %}">
                #{{ t }}
            </a>
            {% endfor %}
        </div>
    </details>
</div>

<div class="file-list-container">
    <ul class="file-list">
        {% for file in files %}
        <li class="file-item">
            <a href="/view/{{ file.path }}" class="file-link">
                <div class="file-preview">
                    <p>{{ file.preview }}</p>
                </div>
                <div class="file-content">
                    <div class="file-name">{{ file.title }}</div>
                    {% if file.tags %}
                    <div class="file-tags">
                        {% for tag in file.tags %}
                        <span class="file-tag">#{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="file-meta">

                        <div class="file-updated">modified: {{ file.updated }}</div>
                    </div>
                </div>
            </a>
        </li>
        {% else %}
        <li class="file-item empty-state">
            No notes found matching your criteria.
        </li>
        {% endfor %}
    </ul>
</div>

{% if total_pages > 1 %}
<div class="pagination">
    {% if current_page > 1 %}
    <a href="/?page={{ current_page - 1 }}&q={{ q }}&tag={{ selected_tag }}" class="page-link">Previous</a>
    {% else %}
    <span class="page-link disabled">Previous</span>
    {% endif %}

    <span class="page-info">Page {{ current_page }} of {{ total_pages }}</span>

    {% if current_page < total_pages %} <a href="/?page={{ current_page + 1 }}&q={{ q }}&tag={{ selected_tag }}"
        class="page-link">Next</a>
        {% else %}
        <span class="page-link disabled">Next</span>
        {% endif %}
</div>
{% endif %}



{% endblock %}